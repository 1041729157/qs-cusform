<div class="form-group item_{$form.name} {$form.extra_class}">
    <label class="left control-label">{$form.title}ï¼š</label>
    <div class="right">
        <div id="checkbox_text_{$gid}">
            <foreach name="form.options" item="option" key="option_key">
                <php>
                    $checkVal=[];
                    if($form['value']){
                        foreach($form['value'] as $val){
                            if($val['title']==$option['title']){
                                $checkVal=$val;
                            }
                        }
                    }
                </php>
                <div>
                    <label class="checkbox-inline" for="{$form.name}{$option_key}">
                        <input type="checkbox" name="checkbox_cus_name{$gid}" id="{$form.name}{$option_key}" class="checkbox" data-title="{$option.title}" {:$checkVal?'checked':''} {$form.extra_attr}>
                        {$option.title}

                        <php>if($option['need_text']):</php>
                        <input type="text" value="{$checkVal.text}">
                        <php>endif;</php>
                    </label>
                </div>
            </foreach>
            <input type="hidden" name="{$form.name}" value=''>
        </div>

        <notempty name="form.tip">
            <span class="check-tips small">{$form.tip}</span>
        </notempty>
        <script id="checkbox_text_val{$gid}" type="application/json">{:json_encode($form["value"])}</script>
        <script>
            function changeValue{$gid}(){
                var val=[];
                $('#checkbox_text_{$gid} input[type=checkbox]').each(function (index,item) {
                    if ($(item).is(':checked')){
                        val.push({
                            title:$(item).data('title'),
                            text:$(item).parent('label').find('input[type=text]').val(),
                        });
                    }
                });
                $('#checkbox_text_{$gid} input[name={$form.name}]').val(JSON.stringify(val));
            }
            $(function () {
                $('#checkbox_text_{$gid} input[name={$form.name}]').val($('#checkbox_text_val{$gid}').html());
                $('#checkbox_text_{$gid} input[type=checkbox]').on('change',function () {
                    changeValue{$gid}();
                });
                $('#checkbox_text_{$gid} input[type=text]').on('input',function (){
                    changeValue{$gid}();
                })
                changeValue{$gid}();
            })
        </script>
    </div>
</div>
